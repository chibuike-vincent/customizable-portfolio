<% title = 'Philanthropic Activities Management' %>

<div class="admin-content-header">
    <button class="btn btn-primary" onclick="showAddForm()">
        <i class="fas fa-plus"></i> Add Activity
    </button>
</div>

<div class="add-form-container" id="addForm" style="display: none;">
    <form action="/admin/philanthropic" method="POST" enctype="multipart/form-data" class="admin-form">
        <h3>Add New Philanthropic Activity</h3>
        <div class="form-group">
            <label for="title">Title *</label>
            <input type="text" id="title" name="title" required>
        </div>
        <div class="form-group">
            <label for="description">Description *</label>
            <textarea id="description" name="description" rows="5" required></textarea>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="date">Date *</label>
                <input type="date" id="date" name="date" required>
            </div>
            <div class="form-group">
                <label for="impact">Impact *</label>
                <input type="text" id="impact" name="impact" placeholder="e.g., 500+ people benefited" required>
            </div>
        </div>
        <div class="form-group">
            <label for="images">Images (Multiple allowed)</label>
            <input type="file" id="images" name="images" accept="image/*" multiple>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Add Activity</button>
            <button type="button" class="btn btn-secondary" onclick="hideAddForm()">Cancel</button>
        </div>
    </form>
</div>

<div class="admin-table-container">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Images</th>
                <th>Title</th>
                <th>Date</th>
                <th>Impact</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% if (philanthropic && philanthropic.length > 0) { %>
                <% philanthropic.forEach(activity => { %>
                <tr>
                    <td>
                        <% if (activity.images && activity.images.length > 0) { %>
                            <img src="<%= activity.images[0] %>" alt="<%= activity.title %>" class="table-image">
                        <% } else { %>
                            <img src="/images/dummy-philanthropic.jpg" alt="<%= activity.title %>" class="table-image">
                        <% } %>
                    </td>
                    <td><%= activity.title %></td>
                    <td><%= new Date(activity.date).toLocaleDateString() %></td>
                    <td><%= activity.impact %></td>
                    <td>
                        <button class="btn-icon" onclick="editActivity('<%= activity._id %>')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <form action="/admin/philanthropic/<%= activity._id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure?')">
                            <input type="hidden" name="_method" value="DELETE">
                            <button type="submit" class="btn-icon danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                <% }); %>
            <% } else { %>
                <tr>
                    <td colspan="5" class="empty-table">No activities found</td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>

<div class="edit-form-container" id="editForm" style="display: none;">
    <form id="editActivityForm" method="POST" enctype="multipart/form-data" class="admin-form">
        <h3>Edit Philanthropic Activity</h3>
        <div class="form-group">
            <label for="edit_title">Title *</label>
            <input type="text" id="edit_title" name="title" required>
        </div>
        <div class="form-group">
            <label for="edit_description">Description *</label>
            <textarea id="edit_description" name="description" rows="5" required></textarea>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="edit_date">Date *</label>
                <input type="date" id="edit_date" name="date" required>
            </div>
            <div class="form-group">
                <label for="edit_impact">Impact *</label>
                <input type="text" id="edit_impact" name="impact" required>
            </div>
        </div>
        <div class="form-group">
            <label for="edit_images">Images (leave empty to keep current, or upload new ones)</label>
            <input type="file" id="edit_images" name="images" accept="image/*" multiple>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Update Activity</button>
            <button type="button" class="btn btn-secondary" onclick="hideEditForm()">Cancel</button>
        </div>
    </form>
</div>

<script>
const activities = <%- JSON.stringify(philanthropic) %>;

function showAddForm() {
    document.getElementById('addForm').style.display = 'block';
    document.getElementById('addForm').scrollIntoView({ behavior: 'smooth' });
}

function hideAddForm() {
    document.getElementById('addForm').style.display = 'none';
}

function editActivity(id) {
    const activity = activities.find(a => a._id === id);
    if (!activity) return;

    document.getElementById('edit_title').value = activity.title;
    document.getElementById('edit_description').value = activity.description;
    document.getElementById('edit_date').value = new Date(activity.date).toISOString().split('T')[0];
    document.getElementById('edit_impact').value = activity.impact;
    document.getElementById('editActivityForm').action = `/admin/philanthropic/${id}`;
    document.getElementById('editForm').style.display = 'block';
    document.getElementById('editForm').scrollIntoView({ behavior: 'smooth' });
}

function hideEditForm() {
    document.getElementById('editForm').style.display = 'none';
}
</script>

